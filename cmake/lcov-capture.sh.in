#!/bin/sh

INFO_FILE=coverage.info
OUTPUT_DIR=$1
if [ -z "${OUTPUT_DIR}" ]; then
    OUTPUT_DIR='coverage'
fi

LCOV=lcov
${LCOV} -c -d @PROJECT_SOURCE_DIR@ -o ${INFO_FILE}
${LCOV} -r ${INFO_FILE} -o ${INFO_FILE} \
    '/Applications/*' \
    '/usr/*' \
    '@PROJECT_SOURCE_DIR@/src/dep/*' \
    '@PROJECT_SOURCE_DIR@/src/cpptests/*' \
    '@PROJECT_SOURCE_DIR@/src/tests/*' \
    '*/sds.c' '*/sds.h'

genhtml -o "${OUTPUT_DIR}" "${INFO_FILE}"